generator client {
    provider = "prisma-client-js"
    features=["referentialActions"]
}

generator typegraphql {
    provider = "typegraphql-prisma"
}

datasource db {
    provider = "mysql"
    url      = env("PRISMA_DATABASE_URL")
}

model User {
    id                  Int               @id @default(autoincrement())
    profilePicture      String            @db.VarChar(500)
    firstName           String            @db.VarChar(25)
    lastName            String            @db.VarChar(25)
    email               String            @unique @db.VarChar(50)
    password            String            @db.VarChar(128)
    projects            UsersOnProjects[]
    tickets             Ticket[]
}

model UsersOnProjects {
    user                User              @relation(fields: [userId], references: [id])
    userId              Int
    project             Project           @relation(fields: [projectId], references: [id], onDelete: Cascade)
    projectId           Int
    role                String            @db.VarChar(50)

    @@id([userId, projectId])
}

model Project {
    id                  Int               @id @default(autoincrement())
    title               String            @db.VarChar(50)
    description         String?           @db.VarChar(255)
    createdAt           DateTime          @db.Timestamp
    finishedAt          DateTime?         @db.Timestamp
    estimateEndAt       DateTime          @db.Timestamp
    members             UsersOnProjects[]
    tickets             Ticket[]
}


model Ticket {
    id                  Int               @id @default(autoincrement())
    projectId           Int
    statusId            Int
    assigneeId          Int
    title               String            @db.VarChar(50)
    description         String?           @db.VarChar(500)
    createdAt           DateTime          @db.Timestamp
    finishedAt          DateTime?         @db.Timestamp
    status              Status            @relation(fields: [statusId], references: [id])
    project             Project           @relation(fields: [projectId], references: [id])
    assignee            User              @relation(fields: [assigneeId], references: [id])
}

model Status {
    id                  Int               @id @default(autoincrement())
    title               String            @db.VarChar(50)
    tickets             Ticket[]
}
